@using System.Web.Optimization
@using InterBook2._0.Views.Shared.App_LocalResources;
@model InterBook2._0.Models.ModelBase

<div class="container">
    <div id="connexion">
        <div id="social" class="inlineBlock">
            <div>CONNEXION</div>
            <button id="facebookConnexion">Connexion avec Facebook</button>
            <button id="googleConnexion">Connexion avec Google</button>
            <button id="linkedInConnexion">Connexion avec LinkedIn</button>
        </div>
        <div id="separateurConnexion" class="inlineBlock">OU</div>
        <div id="formConnexion" class="inlineBlock">
            <span id="errorVide"></span>
            <div>
                <div class="membreCo">
                    <input type="radio" name="membre" id="membreYes" value="1" checked="checked"><label for="membreYes">Déjà Membre</label>
                </div>
                <div class="membreCo">
                    <input type="radio" name="membre" id="membreNo" value="0"><label for="membreNo">Nouveau membre</label>
                </div>
            </div>
            <div>
                <input id="emailConnecter" class="inputCo" name="emailConnecter" placeholder="@Index.Email" type="email" />
            </div>
            <div>
                <input id="passwordConnecter" class="inputCo" name="passwordConnecter" placeholder="@Index.Password" type="password" />
            </div>
            <div id="divBoutonCon">
                <a href="#" id="mdpOublie">Mot de passe oublié ?</a>
                <a href="#" id="btnConnecter">Valider</a>
            </div>
        </div>
        <script>
            $(function () {

                //RADIO BUTTON
                $("#membreYes, #membreNo").change(function () {
                    if ($("#membreNo").is(":checked"))
                        $("#membreNo").parent().css("background", "#cbcbcb");
                    else
                        $("#membreNo").parent().css("background", "none");
                    if ($("#membreYes").is(":checked"))
                        $("#membreYes").parent().css("background", "#cbcbcb");
                    else
                        $("#membreYes").parent().css("background", "none");
                });

                //MOT DE PASSE OUBLIE
                $("#mdpOublie").click(function (evt) {
                    if ($("#passwordConnecter").parent().is(":visible")) {
                        $("#passwordConnecter").parent().hide();
                        $("#mdpOublie").html("retour");
                        $("#btnConnecter").html("Envoyer");
                    }
                    else
                    {
                        $("#passwordConnecter").parent().show();
                        $("#mdpOublie").html("Mot de passe oublié ?");
                        $("#btnConnecter").html("Valider");
                    }
                });

                //FORM VALIDE
                $("#btnConnecter").click(function (evt) {
                    evt.preventDefault();
                    if ($('#emailConnecter').val() == '')
                        return false;

                    //SE CONNECTER
                    if ($("#membreYes").is(":checked")) {
                        var o = { email: $("#emailConnecter").val(), mdp: $("#passwordConnecter").val() };
                        $.ajax({
                            type: "POST",
                            url: "/Account/SignIn",
                            data: o,
                            datatype: 'json' ,
                            success: function (result) {
                                if (result.Reponse == "2")
                                    window.location = "/Account/SignUp";

                                if (result.Reponse == "0")
                                    alert("Erreur d'authentification");
                                if (result.Reponse == "1")
                                {
                                    $('#fade').fadeOut().remove();
                                    $('#connexionPart').animate({ 'top': '-=300px' }, 800, function () { $('#connexionPart').hide(); $('a.close').remove(); });
                                    $("#headerDroite").html("<a href='/dashboard'>" + result.Message + "</a>");
                                }
                            }
                        });
                    }
                    //S'INSCRIRE
                    else if ($("#membreNo").is(":checked"))
                    {
                        var o = { email: $("#emailConnecter").val(), mdp: $("#passwordConnecter").val() };
                        $.ajax({
                            type: "POST",
                            url: "/Account/SignUpHome",
                            data: o,
                            datatype: 'json',
                            success: function (result) {
                                if (result.Message == "200")
                                    window.location = "/Account/SignUp";
                                else
                                    alert("déjà existant");
                            }
                        });
                    }
                    //S'INSCRIRE
                    else if ($("#membreCo").is(":checked")) {
                        window.location = "/Account/SignUp";
                    }
                });
            });
        </script>
    </div>
</div>
